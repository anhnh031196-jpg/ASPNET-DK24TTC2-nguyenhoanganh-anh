@model WebsiteDatLichChuyenNha.Models.Booking

@{
    ViewData["Title"] = "ƒê·∫∑t L·ªãch Chuy·ªÉn Nh√†";
}

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card p-4 fade-in">
            <div class="text-center mb-4">
                <h2 class="text-primary">üì¶ ƒê·∫∑t L·ªãch Chuy·ªÉn Nh√†</h2>
                <p class="text-muted">ƒêi·ªÅn th√¥ng tin b√™n d∆∞·ªõi ƒë·ªÉ nh·∫≠n ∆∞·ªõc t√≠nh chi ph√≠ ngay l·∫≠p t·ª©c</p>
            </div>

            <form asp-action="Create" method="post" id="bookingForm">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label asp-for="CustomerName" class="form-label"></label>
                        <input asp-for="CustomerName" class="form-control" placeholder="Nguy·ªÖn VƒÉn A" required />
                        <span asp-validation-for="CustomerName" class="text-danger"></span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label asp-for="PhoneNumber" class="form-label"></label>
                        <input asp-for="PhoneNumber" class="form-control" placeholder="0909xxxxxx" required />
                        <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                    </div>
                </div>

                <div class="mb-3">
                    <label asp-for="MoveDate" class="form-label"></label>
                    <input asp-for="MoveDate" class="form-control" type="date" required />
                    <span asp-validation-for="MoveDate" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="FromAddress" class="form-label"></label>
                    <input asp-for="FromAddress" class="form-control" placeholder="S·ªë nh√†, ƒë∆∞·ªùng, ph∆∞·ªùng, qu·∫≠n..." required />
                    <span asp-validation-for="FromAddress" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="ToAddress" class="form-label"></label>
                    <input asp-for="ToAddress" class="form-control" placeholder="ƒê·ªãa ch·ªâ n∆°i ƒë·∫øn..." required />
                    <span asp-validation-for="ToAddress" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Distance" class="form-label"></label>
                    <input asp-for="Distance" class="form-control" type="number" step="0.1" placeholder="V√≠ d·ª•: 15.5" required id="distanceInput" />
                    <span asp-validation-for="Distance" class="text-danger"></span>
                    <small class="text-muted">Nh·∫≠p kho·∫£ng c√°ch ∆∞·ªõc t√≠nh (km) ho·∫∑c s·ª≠ d·ª•ng Google Maps ƒë·ªÉ t√≠nh to√°n</small>
                </div>

                <div class="alert alert-info" id="costEstimate" style="display: none;">
                    <h5>üíµ ∆Ø·ªõc T√≠nh Chi Ph√≠:</h5>
                    <p class="mb-0"><strong id="estimatedCost">0 VNƒê</strong></p>
                    <small class="text-muted">
                        Bao g·ªìm: Ph√≠ d·ªãch v·ª• c∆° b·∫£n (<span id="baseFee">@ViewBag.BaseServiceFee</span> VNƒê) + 
                        Chi ph√≠ theo km (<span id="kmRate">@ViewBag.PricePerKm</span> VNƒê/km)
                    </small>
                </div>

                <input asp-for="EstimatedCost" type="hidden" id="estimatedCostInput" />

                <div class="mb-3">
                    <label asp-for="Notes" class="form-label"></label>
                    <textarea asp-for="Notes" class="form-control" rows="3" placeholder="Ghi ch√∫ th√™m v·ªÅ ƒë·ªì ƒë·∫°c (v√≠ d·ª•: ƒë√†n piano, k√©t s·∫Øt...)"></textarea>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">‚úÖ X√°c Nh·∫≠n ƒê·∫∑t L·ªãch</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        const pricePerKm = @ViewBag.PricePerKm;
        const baseFee = @ViewBag.BaseServiceFee;

        document.getElementById('distanceInput').addEventListener('input', function() {
            const distance = parseFloat(this.value) || 0;
            const totalCost = (distance * pricePerKm) + baseFee;
            
            if (distance > 0) {
                document.getElementById('estimatedCost').innerText = totalCost.toLocaleString('vi-VN') + ' VNƒê';
                document.getElementById('estimatedCostInput').value = totalCost;
                document.getElementById('costEstimate').style.display = 'block';
            } else {
                document.getElementById('costEstimate').style.display = 'none';
            }
        });
    </script>
}
